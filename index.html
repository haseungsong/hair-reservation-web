<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë¯¸ìš©ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyBXmLMLMUeu1Y_WyDmvfZkg93u4T-nQewM",
      authDomain: "hair-reservation-78133.firebaseapp.com",
      projectId: "hair-reservation-78133",
      storageBucket: "hair-reservation-78133.firebasestorage.app",
      messagingSenderId: "326975030914",
      appId: "1:326975030914:web:5f050889459dc09ed3d69b"
    };
  
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
  
    let selectedDate = "";
    let selectedTime = "";
  
    window.submitPopupBooking = async () => {
      const name = document.getElementById("popup-name").value.trim();
      const phone = document.getElementById("popup-phone").value.trim();
      const service = document.getElementById("popup-service").value;
      const note = document.getElementById("popup-note").value;
  
      if (!name || !phone || !service) {
        alert("ì´ë¦„, ì—°ë½ì²˜, ì‹œìˆ  í•­ëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
        return;
      }
  
      try {
        await addDoc(collection(db, "hairBookings"), {
          name,
          phone,
          service,
          notes: note,
          date: selectedDate,
          time: selectedTime,
          status: "ëŒ€ê¸° ì¤‘"
        });
        alert("ì˜ˆì•½ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
        document.getElementById("popup").style.display = "none";
        renderCalendarTable();
      } catch (err) {
        console.error("ì˜ˆì•½ ì‹¤íŒ¨:", err);
        alert("ì˜ˆì•½ ì‹¤íŒ¨");
      }
    };
  
    window.submitBooking = async () => {
      const date = document.getElementById("booking-date").value;
      const time = document.getElementById("booking-time").value;
      const service = document.getElementById("service-type").value;
      const notes = document.getElementById("notes").value;
  
      if (!date || !time || !service) {
        alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
  
      try {
        await addDoc(collection(db, "hairBookings"), {
          name: "ì§ì ‘ ì…ë ¥",
          phone: "-",
          date,
          time,
          service,
          notes,
          status: "ëŒ€ê¸° ì¤‘"
        });
        alert("ì˜ˆì•½ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
        renderCalendarTable();
      } catch (err) {
        console.error("ì˜ˆì•½ ì‹¤íŒ¨", err);
        alert("ì˜ˆì•½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    };
  
    function getNext7Days() {
      const days = [];
      const today = new Date();
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        days.push(date);
      }
      return days;
    }
  
    async function renderCalendarTable() {
      const calendarDiv = document.getElementById("calendar-table");
      const hours = ["10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00"];
      const dates = getNext7Days();
  
      const snapshot = await getDocs(collection(db, "hairBookings"));
      const bookedSlots = new Set();
      snapshot.forEach(doc => {
        const data = doc.data();
        bookedSlots.add(`${data.date}_${data.time}`);
      });
  
      let html = `<table style="width: 100%; border-collapse: collapse; min-width: 560px;">`;
      html += `<thead><tr><th style="width: 80px;"></th>`;
      dates.forEach(date => {
        const label = `${date.getMonth() + 1}/${date.getDate()}<br>(${["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "][date.getDay()]})`;
        html += `<th style="padding: 4px; text-align: center; background: #f5f5f5; font-size: 12px;">${label}</th>`;
      });
      html += `</tr></thead><tbody>`;
  
      hours.forEach(time => {
        html += `<td style="text-align: center; font-weight: bold; padding: 10px 4px; font-size: 14px;">${time}</td>`;
        dates.forEach(date => {
          const dateStr = date.toISOString().split("T")[0];
          const key = `${dateStr}_${time}`;
          if (bookedSlots.has(key)) {
            // ì˜ˆì•½ ë¶ˆê°€ëŠ¥: ì£¼í™©ìƒ‰ ì…€
            html += `<td style="padding: 6px; border: 1px solid #ddd; background: #f8d7da;"></td>`;
          } else {
            // ì˜ˆì•½ ê°€ëŠ¥: ì´ˆë¡ìƒ‰ ì…€ + í´ë¦­ ì‹œ íŒì—…
            html += `<td style="padding: 6px; border: 1px solid #ddd; background: #d4edda; cursor:pointer;" onclick="openBookingPopup('${dateStr}', '${time}')"></td>`;
          }
        });
        html += `</tr>`;
      });
  
      html += `</tbody></table>`;
      calendarDiv.innerHTML = html;
    }
  
    window.openBookingPopup = (date, time) => {
      selectedDate = date;
      selectedTime = time;
      document.getElementById("popup-datetime").innerText = `${date} ${time}`;
      document.getElementById("popup").style.display = "block";
    };
  
    window.addEventListener("DOMContentLoaded", () => {
      renderCalendarTable();
    });
  </script>
  

<script type="module">
  let selectedDate = "";
  let selectedTime = "";

  // 7ì¼ê°„ ë‚ ì§œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
  function getNext7Days() {
    const days = [];
    const today = new Date();
    for (let i = 0; i < 7; i++) {
      const date = new Date(today);
      date.setDate(today.getDate() + i);
      days.push(date);
    }
    return days;
  }

  

  // íŒì—… ì—´ê¸°
  window.openBookingPopup = (date, time) => {
    selectedDate = date;
    selectedTime = time;
    document.getElementById("popup-datetime").innerText = `${date} ${time}`;
    document.getElementById("popup").style.display = "block";
  };

  // í˜ì´ì§€ ë¡œë“œì‹œ í…Œì´ë¸” ìë™ ë Œë”ë§
  window.addEventListener("DOMContentLoaded", () => {
    renderCalendarTable();
  });
</script>

</head>
<style>
  input[type="date"],
  input[type="text"],
  select {
    width: 100%;
    padding: 10px 12px;
    font-size: 16px;
    line-height: 1.5;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
    margin-bottom: 16px;
    height: 44px;
  }

  label {
    font-weight: bold;
    display: block;
    margin-bottom: 6px;
  }

  @media (max-width: 500px) {
    input[type="date"],
    input[type="text"],
    select {
      font-size: 15px;
      padding: 10px;
    }
  }

  /* ğŸ“± ëª¨ë°”ì¼ ëŒ€ì‘ í…Œì´ë¸” */
    @media (max-width: 600px) {
      #calendar-table table {
        font-size: 12px;
        min-width: 560px; /* í‘œëŠ” ë„˜ì¹  ìˆ˜ ìˆìŒ */
      }

      #calendar-table {
        overflow-x: auto;
      }
    }

    @media (max-width: 600px) {
  #calendar-table {
    overflow-x: auto;
  }

  #calendar-table table {
    font-size: 11px;           /* í°íŠ¸ ë” ì‘ê²Œ */
    transform: scale(0.88);    /* í…Œì´ë¸”ì„ í™”ë©´ì— ë§ê²Œ ì¶•ì†Œ */
    transform-origin: left;    /* ì™¼ìª½ ê¸°ì¤€ìœ¼ë¡œ ì¶•ì†Œ */
  }

  #calendar-table th, #calendar-table td {
    padding: 2px 4px !important;  /* ì…€ ì•ˆ ì—¬ë°± ìµœì†Œí™” */
  }
}

</style>
<body style="font-family: sans-serif; text-align: center; padding: 0px;">

  <!-- ì˜ˆì•½ í…Œì´ë¸” -->
  <div id="calendar-section" style="margin-top: 0px;">
    <h3 style="text-align: center;">ğŸ“… ì£¼ê°„ ì˜ˆì•½ í˜„í™©</h3>
    <div id="calendar-table" style="overflow-x: auto;"></div>
  </div>

  <!-- ì˜ˆì•½ ì‹ ì²­ í¼ -->
  <div id="booking-section" style="max-width: 400px; margin: 40px auto 0; text-align: left;">
    <h3>ğŸ’ˆ ì˜ˆì•½ ì‹ ì²­</h3>
  
    <label for="booking-date">ë‚ ì§œ ì„ íƒ:</label>
    <input type="date" id="booking-date" /><br>

    <label for="booking-time">ì‹œê°„ ì„ íƒ:</label>
    <select id="booking-time"></select><br>

    <label for="service-type">ì‹œìˆ  ì„ íƒ:</label>
    <select id="service-type">
      <option value="ì»¤íŠ¸">ì»¤íŠ¸</option>
      <option value="íŒ">íŒ</option>
      <option value="ì—¼ìƒ‰">ì—¼ìƒ‰</option>
      <option value="ë“œë¼ì´">ë“œë¼ì´</option>
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>
    </select><br>

    <label for="notes">ë¹„ê³ :</label>
    <input type="text" id="notes" placeholder="ìš”ì²­ ì‚¬í•­ ì…ë ¥" /><br>

    <button onclick="submitBooking()" style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 5px; font-size: 16px;">
      ì˜ˆì•½ ì‹ ì²­
    </button>
  </div>

  <!-- ì˜ˆì•½ íŒì—… -->
  <div id="popup" style="display:none; position:fixed; top:20%; left:50%; transform:translateX(-50%);
    background:#fff; padding:20px; border:1px solid #ccc; border-radius:8px; z-index:999; max-width:300px;">
    <h3>ì˜ˆì•½ ì‹ ì²­</h3>
    <p id="popup-datetime"></p>
    <input type="text" id="popup-name" placeholder="ì´ë¦„ (í•„ìˆ˜)" style="width:100%; margin:8px 0; padding:6px;">
    <input type="text" id="popup-phone" placeholder="ì—°ë½ì²˜ (í•„ìˆ˜)" style="width:100%; margin:8px 0; padding:6px;">
    <select id="popup-service" style="width:100%; margin:8px 0; padding:6px;">
      <option value="">ì‹œìˆ  ì„ íƒ</option>
      <option value="ì»¤íŠ¸">ì»¤íŠ¸</option>
      <option value="íŒ">íŒ</option>
      <option value="ì—¼ìƒ‰">ì—¼ìƒ‰</option>
      <option value="ë“œë¼ì´">ë“œë¼ì´</option>
      <option value="ê¸°íƒ€">ê¸°íƒ€</option>
    </select>
    <input type="text" id="popup-note" placeholder="ë¹„ê³  (ì„ íƒ)" style="width:100%; margin:8px 0; padding:6px;">
    <button onclick="submitPopupBooking()" style="background:green; color:white; padding:8px 12px; border:none; border-radius:4px;">ì˜ˆì•½ ì‹ ì²­</button>
    <button onclick="document.getElementById('popup').style.display='none'" style="margin-left: 8px;">ë‹«ê¸°</button>
  </div>


  
</body>
</html>
